# Morton Filter:一种基于偏置、压缩、和耦合度更低来实现更快、空间利用率更高的布谷鸟过滤器

## 作者
Alex D. Breslow Advanced Micro Devices, Inc. AMD Research
2485 Augustine Drive Santa Clara, CA 95054
Alex.Breslow@amd.com

Nuwan S. Jayasena Advanced Micro Devices, Inc. AMD Research
2485 Augustine Drive Santa Clara, CA 95054
Nuwan.Jayasena@amd.com

## 摘要
近似性成员集合(ASMDSs)在如今计算中非常常见,使用可调整的、较低的错误率(ε)来换取可观的空间节省.较为经典的ASMDSs如Bloom Filter(布隆过滤器),仅支持查看与插入,但是并不支持删除.Cuckoo Filter(布谷鸟过滤器)是一种近期被研发出来的一类ASMDSs,增加了对删除的支持,并通过对每个元素进行更少的资源分配来达到相等的错误率(ε).
这篇论文介绍了Morton Filter(MF),这是一种新型的ASMDSs,对CFs进行了一些关键的改进.与CFs类似,MF支持查看、插入与删除,但其各自的吞吐量提高了1.3倍至2.5倍,0.9倍至15.5倍,以及1.3倍至1.6倍.MF达到这样的增长是通过(1)引入压缩格式,允许逻辑上稀疏的过滤器紧凑地存储在内存中.（2）利用简洁的嵌入式元数据来减少不必要的内存访问.（3）严格偏向于使用单一的哈希函数插入.通过这些优化,查找、插入和删除通常只需要访问过滤器的一个硬件缓存行.这些改进并没有损失空间效率,因为在相同的错误率(ε)的条件下,MF使用的空间通常与CF相当,甚至更小.

## 前言
随着时代的进步,计算机系统在内存层级上又有所新增,在今天的企业级服务器中,拥有三到四级硬件缓存、一个巨大的内存池、几个固态硬盘和一个磁盘池的情况并不少见.随着层次结构的增加,延迟和带宽通常会增加一个或多个数量级.为了避免不必要地访问较慢的介质,许多应用程序使用了近似性成员集合（ASMDSs）.ASMDS像一个哈希集合(例如:元素e是否存在于集合S当中?).然而,不同于哈希集合,ASMDSs无法给出准确的答案,而是给出基于错误率（例如:元素e在S当中的概率）,最差的情况下,错误率(ε)可能为1.ASMDS不会给出虚假的否定结果：如果ASMDS报告e不在S中,那么它肯定不在.ASMDS的一个核心优势是它的错误率ε通常与被编码的元素大小无关,所以ASMDS通常可以比它过滤请求的慢速介质在内存层次上高出一到两级.最常见的ASMDS是布隆过滤器(Bloom Filter),通过一些不同于布隆过滤器的变体来支持删除和计算一个项目的出现次数,尽管存储成本会增加（增加2倍到4倍并不罕见[10, 30]）但是布隆过滤器还是被用于数据存储系统,如谷歌的BigTable[17],分布式分析平台,如Apache Impala[41],生物信息学应用,如DNA测序期间的k-mers计数[49],各种网络应用[14]等等.布隆过滤器的缺陷之一是其最简单的版本表现出较差的参考性,而更适合缓存友好的变体通常空间效率较低[14].

因此,有许多其他的过滤器被提出来,其中两个最实用的过滤器是商数过滤器[6,59]和布谷鸟过滤器[29].商数过滤器和布谷鸟过滤器都与布隆过滤器不同,它们存储的是指纹、短哈希值,每个短哈希值通常与被过滤器编码为属于一个集合S的元素e有一对一的映射关系.布谷鸟过滤器和商数过滤器都支持删除,当过滤器达到负载系数时（即容量负载达到95%）,当期望的错误率(ε)低于1%到3%时,比同等的布隆过滤器使用的空间要少,这是大量应用的普遍情况.

在这篇论文中,我们重点关注布谷鸟过滤器（CF）,并提出了一个新的变体,即 Morton Filter（MF）.与CF一样,MF的存储被组织成一个线性的桶(Bucket)阵列,每个桶包含固定数量的槽(Slot),每个槽可以存储一个指纹(Fingerprint).指纹被映射到表中,方法是将指纹放置在两个桶中的一个,其索引由两个哈希函数（H1和H2）独立确定,这两个函数分别对键进行操作,并输出不同的桶索引.只要有一个候选桶有剩余容量,插入就会成功.当两个候选桶都满了的时候,通过布谷鸟散列[58]来解决,这种散列技术会触发一个递归的驱逐链.